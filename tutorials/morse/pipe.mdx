---
custom_edit_url: null
---

import Image from '/src/components/Images.js';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Part 3: Serial Communication Driver: pipe

## 1. Introduction

You may have noticed from the beginning, that initially we had a package folder into the */lib* folder, which is called *Pipe*.

Finally! Now is the time to use it!

<div align="center">
  <img
    src="https://media.giphy.com/media/3o6UB3VhArvomJHtdK/giphy.gif"
    className="gif_tutorial"
    alt="gif_yes"
  />
</div>

The final part of this tutorial is the integration of a Serial Communication Driver service, in order to be able to communicate with your Luos network using your computer. This will give the opportunity of sending specific characters for their encoding into Morse code. In the end of this part, we will have our complete Morse project, and we will try to send some words so as to see the encoded result in Morse code.

This last part contains the integration of a Luos service called pipe, that will serve as a driver, for the serial port of our Nucleo STM32F072RB.

## 2. Explore the pipe driver utility

The pipe is a Luos prespecified driver which is responsible for serially receiving and sending data, from and to a computer, an RPI, etc. Its only responsability is to pass the data received from the embedded system to the highe level, and to pass the data received from the high level to the embedded system.

<div align="center">
  <Image
    src="/img/tutorials/morse/morse-3-1.png"
    darkSrc="/img/tutorials/morse/morse-3-1-dark.png"
  />
</div>

The pipe service is a part of the embedded network, like any other Luos service.

For this reason, it has the same basic functions like any other service: `Pipe_Init()` and `Pipe_Loop()`. Each time, it receives a frame of data that it stores to a buffer, and waits for another service to demand it. When a service demands the data (`GET_CMD` message), the pipe sends the data that it has stored to the service that demanded it (`SET_CMD` command).

In our project (if your remember well from the previous steps), the encoder application demanded to the pipe to be updated every 10 milliseconds. So the moment that we will integrate the pipe to the project, it will sends the data (if it exists) to the encoder, every 10 milliseconds.

:::info

- If you want more information about the pipe, you can check the [Luos documentation](/docs/tools/gate).
- You can explore all the Luos services examples that we have created for you [here](https://github.com/Luos-io/Examples).

:::

## 3. Integrate the pipe service into our Morse Encoder

You will now need to integrate the pipe into your Luos project. Open *main.c* file and call the `Pipe_Init()` and `Pipe_Loop(`) functions exactly like you did for all the other services:

```c
int main(void)
{
    HAL_Init();
    SystemClock_Config();

    // Init
    Luos_Init();
    Led_Init();
		Encoder_Init();
    Pipe_Init();
    while (1)
    {
        // Loop
        Luos_Loop();
        Led_Loop();
				Encoder_Loop();
        Pipe_Loop();
    }
}
```

Also, include the pipe header file *pipe.h* in the beginning of *main.c*:

```c
/******************************************************************************
 * @file main
 * @brief main file of the project
 * @author Yourself
 * @version 0.0.0
 ******************************************************************************/

#include "stm32f0xx_hal.h"
#include "luos.h"
#include "encoder.h"
#include "led.h"
#include "pipe.h"
```

**Compile your project and check that you have no errors.**

**You are ready!**

## 4. Encode your words to Morse code

You are now ready to send some characters in your MCU, and see the encoded Morse result through the LED of your board.

### Specify port configuration parameters

In order to send characters, we will use the monitoring console provided by PlatformIO.

First, we need to **define the baudrate of our serial USB port and configure the monitoring parameters in the file *platformio.ini*.**

After adding the monitoring part in the end of the file *platformio.ini*, it will look like this:

```c
; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:nucleo_f072rb]
platform = ststm32
board = nucleo_f072rb
framework = stm32cube

build_unflags = -Os
build_flags =
    -include node_config.h
    -DUSE_HAL_DRIVER
    -DUSE_FULL_LL_DRIVER
    -DLUOSHAL=STM32F0
    -O1
lib_extra_dirs = lib/
lib_deps =
    Luos@^2.2.0
    LuosHAL
debug_tool = stlink
upload_protocol = stlink

; Monitoring port config
monitor_speed = 1000000
monitor_filters =
    debug
monitor_flags=
    --eol
    CRLF
```

It is now time to compile your project and flash your MCU with your code. Click on the upload button of PlatformIO. You should finally see that your code is uploaded successfully.

<div align="center">
  <Image src="/img/tutorials/morse/morse-3-2.png" />
</div>

Then, **click to the Serial Monitor button** in PlatformIO:

<div align="center">
  <Image src="/img/tutorials/morse/morse-3-3.png" />
</div>

You should see a miniterm console open, which shows the configuration of your serial port.

You can now send the sequence of the characters that you want to encode. **Do not forget to press the ‚ÄúEnter‚Äù button after the end of each of your words.**

Below you can see an example of sending the word ‚Äúhello‚Äù.

<div align="center">
  <Image src="/img/tutorials/morse/morse-3-4.png" />
</div>

**Congratulations! You have arrived at the end of this project. You can now communicate in Morse code with everybody living on Earth (or not üëΩ).**

<div align="center">
  <img
    src="https://media.giphy.com/media/xT0xeF9hBOWZzAGEr6/giphy.gif"
    className="gif_tutorial"
    alt="gif_sheldonYes"
  />
</div>
