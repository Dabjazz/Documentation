---
custom_edit_url: null
---

import Image from '/src/components/Images.js';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Part 2: Connect ESP32 to the network

## 1. Luos engine in ESP32

With this second part of the tutorial illustrated with a button:

- We will create a Luos service
- Run Luos engine and button package on the ESP32
- Ready to be plug and play on the luos network

If you open the file main.c in the src folder of the example project, you will see:

```c
#include "luos_engine.h"
#include "button.h"

void app_main(void)
{
    Luos_Init();
    Button_Init();

    while (1)
    {
        Luos_Loop();
        Button_Loop();
    }
}
```

To implement luos on a node and be connected to a Luos network, you need:

- luos_engine.h
- Luos_Init()
- Luos_Loop()

Through this network, called Robus, you can send and receive messages between services. Luos provides ESP Familly with a hardware abstraction layer based on the ESP-IDF SDK to be plug and play with ESP32 on a Luos network.

This HAL provides a systick, a timestamp data API and a communication bus based on UART, TIMER and GPIO.

This ESP32 becomes a "node" on the luos network and must be connected with other nodes by a physical layer: a wire or an RS485 bus: [read our documentation](https://www.luos.io/docs/hardware-consideration/electronics).

## 2. Pin of the ESP32 development board to use

Depending on the development board you choose and the MCU it contains, to do this tutorial you will have to adapt the connection. In Luos Engine there is a default configuration for each ESP32 family allowing you to be plug and play on the network !

You can find this default configuration in luos_engine/network/HAL/ESP32.

:::Caution
If you need to change the default pinout, you will need to add node_config.h to your project and reconfigure the pins defined by default in this file.
:::

Pins needed for the luos network

- VCC and GND Pin
- Rx and Tx pin (must be connected together in one wire mode)
- At least 2 PTP pin
- Tx enable pin (only for RS485)

Default configuration:

<Tabs>
    <TabItem value="ESP32 series" label="ESP32 series" className="arrayWithImg">
    <div align="center">

| Pin Name   | Property    |
| ---------- | ----------- |
| PTPA_PIN   | GPIO_NUM_26 |
| PTPB_PIN   | GPIO_NUM_27 |
| TX_EN_PIN  | GPIO_NUM_25 |
| COM_TX_PIN | GPIO_NUM_10 |
| COM_RX_PIN | GPIO_NUM_9  |

  <Image src="/img/tutorials/esp/esp-2-1.png" height="300px" />
</div>
</TabItem>
    <TabItem value="ESP32 C3" label="ESP32 C3" className="arrayWithImg">
    <div align="center">

| Pin Name   | Property   |
| ---------- | ---------- |
| PTPA_PIN   | GPIO_NUM_6 |
| PTPB_PIN   | GPIO_NUM_7 |
| TX_EN_PIN  | GPIO_NUM_9 |
| COM_TX_PIN | GPIO_NUM_4 |
| COM_RX_PIN | GPIO_NUM_5 |

  <Image src="/img/tutorials/esp/esp-2-2.png" height="300px" />
</div>
</TabItem>
    <TabItem value="ESP32 S2 and S3" label="ESP32 S2 and S3" className="arrayWithImg">
    <div align="center">

| Pin Name   | Property    |
| ---------- | ----------- |
| PTPA_PIN   | GPIO_NUM_12 |
| PTPB_PIN   | GPIO_NUM_13 |
| TX_EN_PIN  | GPIO_NUM_14 |
| COM_TX_PIN | GPIO_NUM_17 |
| COM_RX_PIN | GPIO_NUM_18 |

  <Image src="/img/tutorials/esp/esp-2-3.png" height="300px" />
</div>
</TabItem>
</Tabs>

## 3. Detect your network

:::info
Run our [Get started: part 3](/tutorials/get-started/get-started3) by connecting the ESP board as a second board with the pinout described above.
:::

You can now use pyluos-shell in your terminal. You should see the following:

```bash
$ pyluos-shell
Searching for a gate available
Testing /dev/cu.usbserial-D308N885
Testing /dev/cu.usbmodem13102
Connected to "/dev/cu.usbmodem13102".
Sending detection signal.
Waiting for routing table...
Device setup.

 Hit Ctrl-D to exit this interpreter.

Your luos device have been successfully mounted into a "device" object:
  ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
  ┃  ╭node 1            /!\ Not certified            ┃
  ┃  │  Type                Alias               ID   ┃
  ┃  ├> Pipe                Pipe                2    ┃
  ┃  ╰> Gate                gate                1    ┃
╔>┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
║     ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
╚══ 0>┃0 ╭node 2            /!\ Not certified            ┃
      ┃  │  Type                Alias               ID   ┃
      ┃  ├> State               button              3    ┃
     >┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

```
